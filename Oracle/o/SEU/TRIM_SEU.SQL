DECLARE

	CURSOR C1 IS SELECT OWNER, TABLE_NAME FROM DBA_TABLES WHERE OWNER='SEU' 
																												 AND TABLE_NAME IN (SELECT TABELA FROM SEUMIG.MAX_TABLE)
																												-- AND TABLE_NAME IN ('SEUZZZ','SEUZZ1') 
																												ORDER BY TABLE_NAME;
	CURSOR C2(TABELA IN VARCHAR2, OWN IN VARCHAR2) IS SELECT COLUMN_NAME, COLUMN_ID 
																										FROM DBA_TAB_COLUMNS 
																										WHERE OWNER=OWN
																										  AND TABLE_NAME=TABELA
																										  AND DATA_TYPE IN ('VARCHAR2','CHAR')
																										  	ORDER BY COLUMN_ID ASC;
	CURSOR C3(TABELA IN VARCHAR2, OWN IN VARCHAR2) IS SELECT TRIGGER_NAME FROM DBA_TRIGGERS 
																																				WHERE OWNER=OWN
																																				  AND TABLE_NAME=TABELA
																																				  AND TRIGGER_NAME LIKE '%AUDIT%';
	CURSOR C4(OWN IN VARCHAR2) IS SELECT OWNER, TABLE_NAME, CONSTRAINT_NAME FROM DBA_CONSTRAINTS
																															WHERE OWNER=OWN
																															  --AND TABLE_NAME IN ('SEUZZZ','SEUZZ1')
																															  AND TABLE_NAME IN (SELECT TABELA FROM SEUMIG.MAX_TABLE)
																															  AND CONSTRAINT_TYPE='R';
																															  
	
	STR VARCHAR2(4000);
	ATUALIZADOS NUMBER := 0;
	ERRO VARCHAR2(1000);
	CONT NUMBER := 0;
	
BEGIN
  FOR RC4 IN C4('SEU') LOOP
  	STR := 'ALTER TABLE SEU.'||RC4.TABLE_NAME||' DISABLE CONSTRAINT '||RC4.CONSTRAINT_NAME;
  	--DBMS_OUTPUT.PUT_LINE(STR);
  	EXECUTE IMMEDIATE STR;
  END LOOP;
	FOR RC1 IN C1 LOOP
		FOR RC3 IN C3(RC1.TABLE_NAME,RC1.OWNER) LOOP
			STR := 'ALTER TRIGGER '||RC1.OWNER||'.'||RC3.TRIGGER_NAME||' DISABLE';
			--DBMS_OUTPUT.PUT_LINE(STR);
			EXECUTE IMMEDIATE STR;
		END LOOP;
	 	ATUALIZADOS := 0;
	 	STR := 'UPDATE SEU.'||RC1.TABLE_NAME||' SET ';
	 	CONT := 0;
	 	FOR RC2 IN C2(RC1.TABLE_NAME, RC1.OWNER) LOOP
			IF CONT = 0 THEN
				STR := STR||RC2.COLUMN_NAME||'=NVL(TRIM('||RC2.COLUMN_NAME||'),'||RC2.COLUMN_NAME||')';
				CONT := CONT + 1;
			ELSE
				STR := STR||','||RC2.COLUMN_NAME||'=NVL(TRIM('||RC2.COLUMN_NAME||'),'||RC2.COLUMN_NAME||')';
				CONT := CONT + 1;
			END IF;
		END LOOP;
		BEGIN
			EXECUTE IMMEDIATE STR;
			--DBMS_OUTPUT.PUT_LINE(STR);
			ATUALIZADOS := SQL%ROWCOUNT;
			INSERT INTO LOG_TABELA VALUES (RC1.TABLE_NAME, ATUALIZADOS);
			COMMIT;	
		EXCEPTION WHEN OTHERS THEN
			erro := sqlerrm;
			INSERT INTO LOG_TABELA_ERRO VALUES (RC1.TABLE_NAME,erro);
		END;
		FOR RC3 IN C3(RC1.TABLE_NAME,RC1.OWNER) LOOP
			STR := 'ALTER TRIGGER '||RC1.OWNER||'.'||RC3.TRIGGER_NAME||' ENABLE';
			EXECUTE IMMEDIATE STR;
		END LOOP;
	END LOOP;
	FOR RC4 IN C4('SEU') LOOP
	  BEGIN
  		STR := 'ALTER TABLE SEU.'||RC4.TABLE_NAME||' ENABLE CONSTRAINT '||RC4.CONSTRAINT_NAME;
  		EXECUTE IMMEDIATE STR;
  	EXCEPTION WHEN OTHERS THEN
  		DBMS_OUTPUT.PUT_LINE(SQLERRM);
  	END;
  END LOOP;
END;
/