CREATE OR REPLACE PROCEDURE SEU.P_MIGRACAO_POS (RA in varchar2) is
       
BEGIN


  INSERT INTO SEU.SEUABP(SABP_IDEMPRESA, SABP_NUMRA, SABP_DESC, SABP_CODPRSEL, SABP_CODINS, SABP_CEP, SABP_TPLOG, SABP_LOGRADOURO, SABP_NUM,
                         SABP_COMPL, SABP_BAIRRO, SABP_CIDADE, SABP_ESTADO, SABP_TELEFONE1, SABP_TELEFONE2, SABP_TELEFONE3, SABP_EMAIL,
                         SABP_DTNASC, SABP_NATURAL, SABP_NACIONAL, SABP_ESTADOC, SABP_PAI, SABP_MAE, SABP_SEXO, SABP_DTMAT1, SABP_CODESC, SABP_ANOCONCL,
                         SABP_TPCPF, SABP_CPF, SABP_RG, SABP_DTRG, SABP_ESTRG, SABP_TITULO, SABP_CIDTIT, SABP_ESTTIT, SABP_ZONA, SABP_CERTMIL, SABP_PROFISSAO,
                         SABP_VIACARTAO, SABP_PRONTUARIO, SABP_PASTADOC, SABP_ARQMORTO, SABP_IDUSUARIO, SABP_NREG, SABP_PASS )
  -- UNINOVE - PÓS GRADUAÇÃO  2 010 --
  SELECT '2' AS IDEMPRESA, TRIM(JA2_NUMRA) AS NUMRA, JA2_NOME AS DESCR, JA2_PROSEL AS CODPRSEL, TRIM(JA2_CODINS) AS CODINS, NVL(JA2_CEP,'00000000') AS CEP, '01' AS TPLOG,
         NVL(JA2_END,'.') AS LOGRADOURO, NVL(JA2_NUMEND,0) AS NUM, JA2_COMPLE AS COMPL, NVL(JA2_BAIRRO,'.') AS BAIRRO, NVL(JA2_CIDADE,'.') AS CIDADE, NVL(JA2_EST,'SP') AS ESTADO,
         NVL(JA2_FRESID, 0) AS TELEFONE1, JA2_FCELUL AS TELEFONE2, JA2_FCONTA AS TELEFONE3, NVL(JA2_EMAIL, '.') AS EMAIL, JA2_DTNASC AS DTNASC,
         JA2_NATURA AS NATURA, JA2_NACION AS NACIONAL, JA2_ECIVIL AS ESTADOC, JA2_PAI AS PAI, JA2_MAE AS MAE, NVL(JA2_SEXO,'.') AS SEXO,
         JA2_DATA AS DTMAT1, TRIM(JA2_ENTIDA) AS CODESC, JA2_CONCLU AS ANOCONCL, JA2_TIPCPF AS TPCPF, NVL(JA2_CPF,'99999999999') AS CPF, NVL(JA2_RG,'.') AS RG,
         JA2_DTRG AS DTRG, NVL(JA2_ESTRG,'SP') AS ESTRG, JA2_TITULO AS TITULO, JA2_CIDTIT AS CIDTIT, JA2_ESTTIT AS ESTTIT, JA2_ZONA AS ZONA,
         TRIM(JA2_CMILIT) AS CERTMIL, JA2_PROFIS AS PROFISSAO, JA2_VERCAR AS VIACARTAO, JA2_PRONTU AS PRONTUARIO, JA2_PASTA AS PASTA,
         JA2_ARQMOR AS ARQMORTO, 1 AS IDUSUAARIO, 0 AS NREG, JA2_WPSS AS PASS
    FROM SIGAGE.JA2010
   WHERE JA2_FILIAL = '  '
     AND TRIM(JA2_NUMRA)  = RA
     AND TRIM(JA2_NUMRA)  NOT IN (SELECT SABP_NUMRA
                                    FROM SEU.SEUABP
                                   WHERE SABP_IDEMPRESA = 2
                                     AND SABP_NUMRA = RA)
     AND D_E_L_E_T_ = ' ';

  INSERT INTO SEU.SEUABO(SABO_IDEMPRESA, SABO_NUMRA, SABO_CODCUR, SABO_VERSAO, SABO_ANOLET, SABO_PERIODO, SABO_CODUND, SABO_TURNO, SABO_SERIE, SABO_TURMA,
                            SABO_SITALU, SABO_TPSIT, SABO_ATIVO, SABO_DATA, SABO_ORIGEM, SABO_AMG, SABO_IDUSUARIO, SABO_NREG )
  SELECT '2' AS IDEMPRESA, TRIM(JBE_NUMRA) AS NUMRA, TRIM(JAH_CURSO) AS COCUR, JAH_VERSAO AS VERSAO, JBE_ANOLET AS ANOLET, JBE_PERIOD AS PERIODO,
         JAH_UNIDAD AS CODUND, JAH_TURNO AS TURNO, JBE_PERLET AS SERIE, JBE_TURMA AS TURMA,
         CASE
              WHEN JBE_ATIVO IN ('1','2') AND JBE_SITUAC IN ('1','2') THEN '001' -- 'Matriculado'
              WHEN JBE_ATIVO = '3' THEN '002' -- 'Transferido'
              WHEN JBE_ATIVO = '4' THEN '003' -- 'Trancado'
              WHEN JBE_ATIVO = '5' THEN '004' -- 'Formado'
              WHEN JBE_ATIVO = '6' THEN '005' -- 'Cancelado'
              WHEN JBE_ATIVO = '7' THEN '006' -- 'Desistente'
              WHEN JBE_ATIVO = '8' THEN '007' -- 'Óbito'
              WHEN JBE_ATIVO = '9' THEN '008' -- 'Débitos Finaceiros'
              WHEN JBE_ATIVO = 'A' THEN '009' -- 'Integralizado'
              WHEN JBE_ATIVO = 'B' THEN '010' -- 'Transferência Externa'
              WHEN JBE_ATIVO = 'C' THEN '011' -- 'Ação Judicial'
          END AS SITALU,
         DECODE(JBE_TIPO,'1','001','002') AS TPSTI,
         DECODE(JBE_ATIVO, '1', 'S', 'S') AS ATIVO, JBE_DTMATR AS DATA, '001' AS ORIGEM, 0 AS AMG, 1 AS IDUSUARIO, 0 AS NREG
    FROM SIGAGE.JBE010 A,
         SIGAGE.JAH010 B
   WHERE JBE_FILIAL = '  '
     AND JAH_FILIAL = '  '
     AND JAH_CODIGO = JBE_CODCUR
     AND TRIM(JBE_NUMRA)  = RA
     AND TRIM(JBE_NUMRA)  NOT IN (SELECT SABO_NUMRA
                                    FROM SEU.SEUABO
                                   WHERE SABO_IDEMPRESA = 2
                                     AND SABO_NUMRA = RA )
     AND A.D_E_L_E_T_ = ' '
     AND B.D_E_L_E_T_ = ' ';

      INSERT INTO SEU.SEUABU  (SABU_IDEMPRESA, SABU_NUMRA, SABU_CODCUR, SABU_VERSAO, SABU_ANOLET, SABU_PERIODO, SABU_SERIE, SABU_CODDIS, SABU_REGIME, SABU_SITDIS, SABU_MEDAEX, SABU_MEDFIM, SABU_TITULO, SABU_CURNOVO, SABU_VERNOVO, SABU_ANONOVO, SABU_PERNOVO, SABU_TURNOVO, SABU_UNDNOVO, SABU_SERNOVO, SABU_TRMNOVO, SABU_DISNOVO, SABU_IDUSUARIO, SABU_NREG, SABU_DTMAT)
      SELECT DISTINCT
             SABO_IDEMPRESA SABU_IDEMPRESA,
             SABO_NUMRA SABU_NUMRA,
             SABO_CODCUR SABU_CODCUR,
             SABO_VERSAO SABU_VERSAO,
             SABO_ANOLET SABU_ANOLET,
             SABO_PERIODO SABU_PERIODO,
             SABO_SERIE   SABU_SERIE,
             SAAY_CODDIS  SABU_CODDIS,
             '007'        SABU_REGIME,
             '001'        SABU_SITDIS,
             0 SABU_MEDAEX,
             0 SABU_MEDFIM,
             NULL SABU_TITULO,
             NULL SABU_CURNOVO,
             NULL SABU_VERNOVO,
             ' ' SABU_ANONOVO,
             ' ' SABU_PERNOVO,
             NULL SABU_TURNOVO,
             NULL SABU_UNDNOVO,
             NULL SABU_SERNOVO,
             NULL SABU_TRMNOVO,
             NULL SABU_DISNOVO,
             1 SABU_IDUSUARIO,
             0 SABU_NREG,
             TO_CHAR(SYSDATE, 'YYYYMMDD') SABU_DTMAT
        FROM SEU.SEUAAY,
             SEU.SEUABO
       WHERE SAAY_IDEMPRESA = 2
         AND SAAY_IDEMPRESA = SABO_IDEMPRESA
         AND SAAY_CODCUR    = SABO_CODCUR
         AND SAAY_VERSAO    = SABO_VERSAO
         AND SAAY_SERIE     = SABO_SERIE
         AND SABO_NUMRA NOT IN  ( SELECT DISTINCT SABU_NUMRA
                                    FROM SEU.SEUABU
                                   WHERE SABU_IDEMPRESA = 2
                                     AND SABU_NUMRA = RA )
         AND SABO_ATIVO = 'S'
         AND SABO_NUMRA = RA;


  COMMIT;
END;
/

grant execute on seu.P_MIGRACAO_POS to r_seu_all;
