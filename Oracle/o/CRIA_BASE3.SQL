SET VER OFF
SET ECHO OFF
SET PAGES 0
set serveroutput on size 50000
set lines 200

SPOOL CRIA_USUARIO.SQL
SELECT 'CREATE USER '||USERNAME||' IDENTIFIED BY VALUES '||
''''||PASSWORD||''''||' PROFILE '||PROFILE||' DEFAULT TABLESPACE '||DEFAULT_TABLESPACE||' TEMPORARY TABLESPACE '||
TEMPORARY_TABLESPACE||';'
FROM DBA_USERS WHERE USERNAME IN ('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS')

/
SPOOL OFF

SPOOL CRIA_ROLE.SQL
SELECT DISTINCT 'CREATE ROLE '||GRANTED_ROLE||';' FROM DBA_ROLE_PRIVS
WHERE GRANTEE IN('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS')
/
SPOOL OFF

SPOOL GRANT_ROLE.SQL
SELECT 'GRANT '||GRANTED_ROLE||' TO '||GRANTEE||';'
FROM DBA_ROLE_PRIVS WHERE GRANTEE  IN ('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS')
/
SPOOL OFF

SPOOL GRANT_SYS_PRIVS.SQL
SELECT 'GRANT '||PRIVILEGE||' TO '||GRANTEE||';'
FROM DBA_SYS_PRIVS WHERE GRANTEE IN ('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS')
/
SPOOL OFF

SPOOL CRIA_DB_LINK.SQL
SELECT 'CREATE PUBLIC DATABASE LINK '||A.DB_LINK||' CONNECT TO '||A.USERNAME||
' IDENTIFIED BY '||B.PASSWORD||' USING '||''''||A.HOST||''''||';'
FROM DBA_DB_LINKS A, SYS.LINK$ B
WHERE A.DB_LINK = B.NAME
AND A.OWNER='PUBLIC'
/
SPOOL OFF

SPOOL CRIA_TABLESPACE.SQL
DECLARE

CURSOR C1 IS SELECT TABLESPACE_NAME, INITIAL_EXTENT, NEXT_EXTENT, MAX_EXTENTS
								FROM DBA_TABLESPACES WHERE TABLESPACE_NAME IN ( SELECT DISTINCT TABLESPACE_NAME
FROM DBA_SEGMENTS WHERE OWNER IN ('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS'));

CURSOR C2 (TABLESPACE IN VARCHAR2) IS SELECT FILE_NAME, BYTES FROM DBA_DATA_FILES
																			   WHERE TABLESPACE_NAME=TABLESPACE;
FILE DBA_DATA_FILES.FILE_NAME%TYPE;
BYTES DBA_DATA_FILES.BYTES%TYPE;
													   
BEGIN
	
	FOR RC1 IN C1 LOOP
		DBMS_OUTPUT.PUT_LINE(CHR(10)||CHR(10)||'CREATE TABLESPACE '||RC1.TABLESPACE_NAME||' DATAFILE ');
		OPEN C2(RC1.TABLESPACE_NAME);
		FETCH C2 INTO FILE, BYTES;
		DBMS_OUTPUT.PUT_LINE(''''||FILE||''''||' SIZE '||BYTES||' REUSE');
		LOOP
		  FETCH C2 INTO FILE, BYTES;
		  EXIT WHEN C2%NOTFOUND;
			DBMS_OUTPUT.PUT_LINE(','||''''||FILE||''''||' SIZE '||BYTES||' REUSE');
	  END LOOP;
	  CLOSE C2;
	  DBMS_OUTPUT.PUT_LINE('DEFAULT STORAGE (');
		DBMS_OUTPUT.PUT_LINE('INITIAL '||RC1.INITIAL_EXTENT);
		DBMS_OUTPUT.PUT_LINE('NEXT '||RC1.NEXT_EXTENT);
		DBMS_OUTPUT.PUT_LINE('MAXEXTENTS '||RC1.MAX_EXTENTS||');');
	END LOOP;
END;
/
SPOOL OFF

SPOOL CRIA_SYNONYM.SQL
SELECT 'CREATE '||DECODE(OWNER,'PUBLIC','PUBLIC SYNONYM ','SYNONYM '||OWNER||'.')
			 ||'"'||SYNONYM_NAME||'" FOR '||TABLE_OWNER||'."'
			 ||TABLE_NAME||'";'
FROM DBA_SYNONYMS
WHERE TABLE_OWNER IN ('SPMS'
,'SPMS_DISCOVERER'
,'ALCOA'
,'OWA_USER_COMUM'
,'SOA_PRODUCAO'
,'WEB_SPMS'
,'U_SPMS'
,'INTERCONNECT_DB_SPMS') ORDER BY OWNER
/
SPOOL OFF
